# üêõ –ü–†–ò–ú–ï–†–´ –û–®–ò–ë–û–ö –ò –ò–• –ü–û–°–õ–ï–î–°–¢–í–ò–Ø

## 1Ô∏è‚É£ –î–£–ë–õ–ò–†–û–í–ê–ù–ò–ï: –î–≤–æ–π–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∑—Ä–æ—Å–ª—ã—Ö –≤ parser_functions.py

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:

```
–§–∞–π–ª: parser_functions.py

–°—Ç—Ä–æ–∫–∏ 285-303:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ # ========== 4. –û–ë–†–ê–ë–û–¢–ö–ê –í–ó–†–û–°–õ–´–•  ‚îÇ
‚îÇ for num_info in all_numbers:        ‚îÇ
‚îÇ     ...–ª–æ–≥–∏–∫–∞ –±–∞–∑–æ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏...  ‚îÇ
‚îÇ     if any(k in left_context or ... ‚îÇ
‚îÇ         if data['adults'] == 0:     ‚îÇ
‚îÇ             data['adults'] = num    ‚îÇ
‚îÇ         processed_positions.add(pos)‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

–°—Ç—Ä–æ–∫–∏ 304-327:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ # ========== 4. –û–ë–†–ê–ë–û–¢–ö–ê –í–ó–†–û–°–õ–´–•  ‚îÇ  ‚Üê –¢–û–ñ–ï –°–ê–ú–û–ï –ù–ê–ó–í–ê–ù–ò–ï!
‚îÇ for num_info in all_numbers:        ‚îÇ
‚îÇ     ...–ª–æ–≥–∏–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ ‚îÇ
‚îÇ     if left_context in ['–Ω–∞—Å', '–º—ã']‚îÇ
‚îÇ         ...–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞... ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è –ø—Ä–∏ –≤–≤–æ–¥–µ "—è –æ–¥–Ω–∞ –∏ –º–æ–π —Å—ã–Ω 5 –ª–µ—Ç":

```
–û–ñ–ò–î–ê–ï–ú–û:
  adults = 1
  children = [5 –ª–µ—Ç]

–†–ï–ê–õ–¨–ù–û:
  –ü–µ—Ä–≤—ã–π —Ü–∏–∫–ª (285):
    - –ò—â–µ—Ç —á–∏—Å–ª–æ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º "–≤–∑—Ä–æ—Å–ª" –∏–ª–∏ "–≤–∑—Ä" ‚Üí –ù–ï –Ω–∞—Ö–æ–¥–∏—Ç
    - –ù–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —á–∏—Å–ª–æ "1" (–∏–∑ "—è –æ–¥–Ω–∞")
    
  –í—Ç–æ—Ä–æ–π —Ü–∏–∫–ª (304):
    - –ò—â–µ—Ç —á–∏—Å–ª–æ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º "–Ω–∞—Å" –∏–ª–∏ "–º—ã" ‚Üí –ù–ï –Ω–∞—Ö–æ–¥–∏—Ç
    - –ù–æ –Ω–∞—Ö–æ–¥–∏—Ç "—è" —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º ‚Üí –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç "—è –æ–¥–Ω–∞"
    - adults = 1 ‚úì (—Å–ª—É—á–∞–π–Ω–æ —Å—Ä–∞–±–æ—Ç–∞–ª–æ)
    
  –ù–û –µ—Å–ª–∏ –ø–æ–º–µ–Ω—è—Ç—å –ø–æ—Ä—è–¥–æ–∫ —Å–ª–æ–≤ "–º–æ–π —Å—ã–Ω –∏ —è –æ–¥–Ω–∞":
    - –ü–µ—Ä–≤—ã–π —Ü–∏–∫–ª –º–æ–≥ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å "—Å—ã–Ω" –∫–∞–∫ –∫–æ–Ω—Ç–µ–∫—Å—Ç –∫ —á–∏—Å–ª—É
    - –í—Ç–æ—Ä–æ–π —Ü–∏–∫–ª —Å–Ω–æ–≤–∞ –ø—ã—Ç–∞–µ—Ç—Å—è –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å
    - –ö–û–ù–§–õ–ò–ö–¢!
```

---

## 2Ô∏è‚É£ –ü–†–û–ë–õ–ï–ú–ê: –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –¥–µ—Ç–µ–π

### –°—Ü–µ–Ω–∞—Ä–∏–π:

```
–®–ê–ì 1: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç: "—è –∏ –º–æ–π —Å—ã–Ω 5 –ª–µ—Ç"
  ‚Üí system: children = [60 –º–µ—Å—è—Ü–µ–≤] (5 –ª–µ—Ç)

–®–ê–ì 2: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç "–ù–µ—Ç, –∏—Å–ø—Ä–∞–≤–∏—Ç—å"
  ‚Üí system: —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç —á—Ç–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å

–®–ê–ì 3: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç: "—Å—Ç–æ–ø, –æ—à–∏–±–∫–∞, —è –æ–¥–Ω–∞"
  ‚Üí parse_user_response() –≤—ã–¥–∞—ë—Ç:
    {
      'children': [],           ‚Üê –ü–£–°–¢–û!
      'raw_text': '—è –æ–¥–Ω–∞'
    }

–®–ê–ì 4: –í—ã–∑—ã–≤–∞–µ—Ç—Å—è save_partial_data(context, parsed_data):
  if 'children' in new_data and new_data['children']:  ‚Üê –£–°–õ–û–í–ò–ï!
      # –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã—Ö –¥–µ—Ç–µ–π
      for age, original in zip(...):
          if age not in user_data['children']:
              user_data['children'].append(age)

  –ü–†–û–ë–õ–ï–ú–ê: new_data['children'] = [] (–ü–£–°–¢–û!)
           –£—Å–ª–æ–≤–∏–µ if [] and ... = FALSE
           –ù–û parsed_data —Å–æ–¥–µ—Ä–∂–∏—Ç '[]' 
           –ü—Ä–æ–≥—Ä–∞–º–º–∞ –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ—Ç!
           
  –†–ï–ó–£–õ–¨–¢–ê–¢: children = [60] –æ—Å—Ç–∞—ë—Ç—Å—è –æ—Ç —à–∞–≥–∞ 1!
             –ù–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø—Ä–∏–º–µ–Ω–∏–ª–∏—Å—å!
```

### –ü–æ—á–µ–º—É —ç—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ:

```python
# –ü–æ—Å–ª–µ –®–ê–ì 3 —Å–∏—Å—Ç–µ–º–∞ –¥—É–º–∞–µ—Ç:
{
  'adults': 1,
  'children': [60],      ‚Üê –í–°–Å –ï–©–Å –ó–î–ï–°–¨! (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û)
  'raw_text': '—è –æ–¥–Ω–∞'
}

# –ü—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ missing_points():
raw_text_lower = '—è –æ–¥–Ω–∞'
if any(keyword in raw_text_lower for keyword in ['—Ä–µ–±–µ–Ω', '–¥–µ—Ç', ...]):
    # –ù–µ –Ω–∞—Ö–æ–¥–∏—Ç –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ
    
# –°–∏—Å—Ç–µ–º–∞ –¥—É–º–∞–µ—Ç: –¥–µ—Ç–∏ –Ω–µ —É–ø–æ–º—è–Ω—É—Ç—ã ‚Üí –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç children
# –ù–æ –¥–µ—Ç–∏ —É–∂–µ –µ—Å—Ç—å –≤ —Å–∏—Å—Ç–µ–º–∞ ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ!

# –§–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:
"‚úÖ –û—Ç–ª–∏—á–Ω–æ! –í–æ—Ç –≤–∞—à–∞ –≥—Ä—É–ø–ø–∞:
 –í–∑—Ä–æ—Å–ª—ã—Ö: 1
 –î–µ—Ç–∏: 1 —Ä–µ–±–µ–Ω–æ–∫ (5 –ª–µ—Ç)"        ‚Üê –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û! –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∫–∞–∑–∞–ª "—è –æ–¥–Ω–∞"!
```

---

## 3Ô∏è‚É£ –ü–†–û–ë–õ–ï–ú–ê: –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–µ–≥–æ raw_text

### –°—Ü–µ–Ω–∞—Ä–∏–π:

```
–®–ê–ì 1: –ü–µ—Ä–≤—ã–π –≤–≤–≤–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  –í–≤–æ–¥: "—É –Ω–∞—Å –µ—Å—Ç—å –¥–µ—Ç–∏ 7 –∏ 5 –ª–µ—Ç"
  ‚Üí parse_user_response():
    {
      'adults': 0,
      'children': [84, 60],  (7 –∏ 5 –ª–µ—Ç –≤ –º–µ—Å—è—Ü–∞—Ö)
      'raw_text': '—É –Ω–∞—Å –µ—Å—Ç—å –¥–µ—Ç–∏ 7 –∏ 5 –ª–µ—Ç'
    }
  
–®–ê–ì 2: check_missing_points(user_data)
  raw_text_lower = '—É –Ω–∞—Å –µ—Å—Ç—å –¥–µ—Ç–∏ 7 –∏ 5 –ª–µ—Ç'
  if any(keyword in raw_text_lower for keyword in ['—Ä–µ–±–µ–Ω', '–¥–µ—Ç', ...]):
      ‚Üí –ù–ê–•–û–î–ò–¢ '–¥–µ—Ç' –≤ raw_text ‚úì
  if not user_data['children']:
      ‚Üí children = [84, 60] ‚Üí –ù–ï –ø—É—Å—Ç–æ
      
  missing_points: ["–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∑—Ä–æ—Å–ª—ã—Ö"]  (–¥–µ—Ç–∏ —É–∂–µ —É–∫–∞–∑–∞–Ω—ã)

–®–ê–ì 3: –°–∏—Å—Ç–µ–º–∞ —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø—Ä–æ –≤–∑—Ä–æ—Å–ª—ã—Ö
  –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "2 –≤–∑—Ä–æ—Å–ª—ã—Ö"
  
–®–ê–ì 4: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç "–ù–µ—Ç, –∏—Å–ø—Ä–∞–≤–∏—Ç—å" –∏ –ø–∏—à–µ—Ç
  –í–≤–æ–¥: "–∑–∞–±—ã–ª–∏ —Å–∫–∞–∑–∞—Ç—å, –Ω–µ—Ç –¥–µ—Ç–µ–π"
  ‚Üí parse_user_response():
    {
      'adults': 0,      (–Ω–µ —É–∫–∞–∑–∞–ª –≤ —ç—Ç–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏)
      'children': [],   (—É–∫–∞–∑–∞–Ω–æ —è–≤–Ω–æ: "–Ω–µ—Ç –¥–µ—Ç–µ–π")
      'raw_text': '–∑–∞–±—ã–ª–∏ —Å–∫–∞–∑–∞—Ç—å, –Ω–µ—Ç –¥–µ—Ç–µ–π'
    }
  
  save_partial_data(context, parsed_data):
    if parsed_data['children']:  ‚Üê [] = FALSE
        # –ù–ò–ß –ï–ì–û –ù–ï –ü–†–û–ò–°–•–û–î–ò–¢!
    
  –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –í–°–ï –ï–©–ï:
    {
      'adults': 2,
      'children': [84, 60],  ‚Üê –í–°–ï –ï–©–ï –ó–î–ï–°–¨!
      'raw_text': '–∑–∞–±—ã–ª–∏ —Å–∫–∞–∑–∞—Ç—å, –Ω–µ—Ç –¥–µ—Ç–µ–π'  ‚Üê –ò–ó–ú–ï–ù–ò–õ–°–Ø
    }

–®–ê–ì 5: check_missing_points(user_data) —Å–Ω–æ–≤–∞ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
  raw_text_lower = '–∑–∞–±—ã–ª–∏ —Å–∫–∞–∑–∞—Ç—å, –Ω–µ—Ç –¥–µ—Ç–µ–π'
  if any(keyword in raw_text_lower for keyword in ['—Ä–µ–±–µ–Ω', '–¥–µ—Ç', ...]):
      ‚Üí –ù–ê–•–û–î–ò–¢ '–¥–µ—Ç' –≤ raw_text ‚úì
  if not user_data['children']:
      ‚Üí children = [84, 60] ‚Üí –ù–ï –ø—É—Å—Ç–æ!
      
  –ù–û –õ–û–ì–ò–ö–ê –û–®–ò–ë–û–ß–ù–ê:
    - –ù–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ raw_text –≥–æ–≤–æ—Ä–∏—Ç "–Ω–µ—Ç –¥–µ—Ç–µ–π"
    - –ù–æ —Å—Ç–∞—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ children –≥–æ–≤–æ—Ä–∏—Ç [84, 60]
    - –°–∏—Å—Ç–µ–º–∞ –ö–û–ù–§–õ–ò–ö–¢–£–ï–¢!
```

---

## 4Ô∏è‚É£ –ü–†–û–ë–õ–ï–ú–ê: –¢—Ä–∏ —Ä–∞–∑–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–∏ —É—Ç–æ—á–Ω–µ–Ω–∏—è

### –û–Ω–∏ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –≤ –∫–æ–¥–µ:

```python
# bot.py, —Å—Ç—Ä–æ–∫–∞ 1844
async def handle_adults_clarification(update, context, user_text, user_data):
    """–£—Ç–æ—á–Ω–µ–Ω–∏–µ –≤–∑—Ä–æ—Å–ª—ã—Ö"""
    # ... –ø–∞—Ä—Å–∏—Ç —á–∏—Å–ª–∞ ...
    if adults is None:
        return CONFIRMATION  # –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç, –µ—Å–ª–∏ –Ω–µ –ø–æ–Ω—è–ª
    # –û–±–Ω–æ–≤–ª—è–µ—Ç context.user_data['user_data'] ‚úì

# bot.py, —Å—Ç—Ä–æ–∫–∞ 1904
async def handle_children_clarification(update, context, user_text, user_data):
    """–£—Ç–æ—á–Ω–µ–Ω–∏–µ –¥–µ—Ç–µ–π"""
    # ... –ø–∞—Ä—Å–∏—Ç –≤–æ–∑—Ä–∞—Å—Ç—ã ...
    if not (parsed_data['children'] or "–Ω–µ—Ç" in text_lower):
        return CONFIRMATION  # –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç, –µ—Å–ª–∏ –Ω–µ –ø–æ–Ω—è–ª
    # –ù–û –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç context —è–≤–Ω–æ!

# bot.py, —Å—Ç—Ä–æ–∫–∞ 1925
async def handle_pregnant_clarification(update, context, user_text, user_data):
    """–£—Ç–æ—á–Ω–µ–Ω–∏–µ –±–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏"""
    if any(word in text_lower for word in ['–¥–∞', '–±–µ—Ä–µ–º–µ–Ω', ...]):
        user_data['pregnant'] = True
    elif any(word in text_lower for word in ['–Ω–µ—Ç', '–Ω–µ –±–µ—Ä–µ–º–µ–Ω', ...]):
        user_data['pregnant'] = False
    else:
        return CONFIRMATION  # –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç, –µ—Å–ª–∏ –Ω–µ –ø–æ–Ω—è–ª
    # –û–±–Ω–æ–≤–ª—è–µ—Ç context.user_data['user_data'] ‚úì
```

### –ü—Ä–æ–±–ª–µ–º–∞:

```
1. –≠–¢–ò –§–£–ù–ö–¶–ò–ò –ù–ò–ö–û–ì–î–ê –ù–ï –í–´–ó–´–í–ê–Æ–¢–°–Ø –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞!
   - –û–Ω–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã, –Ω–æ –Ω–µ—Ç –≤—ã–∑–æ–≤–æ–≤ handle_adults_clarification()
   - –ù–µ—Ç –≤—ã–∑–æ–≤–æ–≤ handle_children_clarification()
   - –ù–µ—Ç –≤—ã–∑–æ–≤–æ–≤ handle_pregnant_clarification()

2. –í–ú–ï–°–¢–û –≠–¢–û–ì–û –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è ask_for_clarification() –∫–æ—Ç–æ—Ä–∞—è:
   - –°–ø—Ä–∞—à–∏–≤–∞–µ—Ç –≤–æ–ø—Ä–æ—Å –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç context.user_data['next_question']
   - –ù–æ –¥–∞–ª—å—à–µ —á—Ç–æ? –ö—Ç–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —ç—Ç–æ—Ç —Ñ–ª–∞–≥?
   
3. –≠–¢–ò –§–£–ù–ö–¶–ò–ò –ú–û–ì–£–¢ –ë–´–¢–¨ "–ú–Å–†–¢–í–´–ú –ö–û–î–û–ú" (orphaned code)
   - –ò—Ö —É–¥–∞–ª—è–ª–∏, –Ω–æ –∑–∞–±—ã–ª–∏ —É–¥–∞–ª–∏—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ?
   - –ò–ª–∏ –æ–Ω–∏ –µ—â—ë –Ω–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã?

4. –ï–°–õ–ò –æ–Ω–∏ –í–°–ï –ñ–ï –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≥–¥–µ-—Ç–æ —Å–∫—Ä—ã—Ç–Ω–æ:
   - –õ–æ–≥–∏–∫–∞ —Ä–∞—Å—Ö–æ–¥–∏—Ç—Å—è –º–µ–∂–¥—É —Ç—Ä–µ–º—è —Ñ—É–Ω–∫—Ü–∏—è–º–∏
   - –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–µ–¥—Å–∫–∞–∑–∞—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ
```

---

## 5Ô∏è‚É£ –ü–†–û–ë–õ–ï–ú–ê: –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π —Ñ–ª–∞–≥ waiting_for_correction

### –í –∫–æ–¥–µ:

```python
# bot.py, —Å—Ç—Ä–æ–∫–∞ 2070
elif user_choice == "‚úèÔ∏è –ù–µ—Ç, –∏—Å–ø—Ä–∞–≤–∏—Ç—å":
    context.user_data['waiting_for_correction'] = True  ‚Üê –£–°–¢–ê–ù–û–í–õ–ï–ù
    await update.message.reply_text("–ù–∞–ø–∏—à–∏—Ç–µ, —á—Ç–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å...")
    return CONFIRMATION

# –ê –¥–∞–ª—å—à–µ? –ü–æ–∏—Å–∫ –ø–æ —Ñ–∞–π–ª—É –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
# grep "waiting_for_correction" bot.py
# –†–µ–∑—É–ª—å—Ç–∞—Ç—ã: –¢–û–õ–¨–ö–û –¢–ê –°–¢–†–û–ö–ê, –≥–¥–µ –æ–Ω —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!
#
# –≠–¢–û –û–ó–ù–ê–ß–ê–ï–¢: –§–ª–∞–≥ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –Ω–æ –ù–ò–ö–û–ì–î–ê –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è!
```

### –†–∏—Å–∫:

```
–ï—Å–ª–∏ –≤ –±—É–¥—É—â–µ–º –∫—Ç–æ-—Ç–æ –Ω–∞–ø–∏—à–µ—Ç:

    if context.user_data.get('waiting_for_correction'):
        # ...—Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞...

–¢–æ —ç—Ç–∞ –ª–æ–≥–∏–∫–∞ –ù–ò–ö–û–ì–î–ê –Ω–µ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∞, –ø–æ—Ç–æ–º—É —á—Ç–æ —Ñ–ª–∞–≥
–Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ –¥—Ä—É–≥–∏—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö –∏ –º–æ–∂–µ—Ç –ø–æ—Ç–µ—Ä—è—Ç—å—Å—è.
```

---

## üìä –¢–ê–ë–õ–ò–¶–ê –ö–û–ù–§–õ–ò–ö–¢–û–í

| –ü—Ä–æ–±–ª–µ–º–∞ | –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å | –°–µ—Ä—å—ë–∑–Ω–æ—Å—Ç—å |
|----------|-----------|------------|------------|
| –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–∑—Ä–æ—Å–ª—ã—Ö | parser_functions.py | –°—Ä–µ–¥–Ω—è—è | –ö–†–ò–¢–ò–ß–ù–ê |
| –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–¥–∞–ª–∏—Ç—å –¥–µ—Ç–µ–π | save_partial_data() | –í–´–°–û–ö–ê–Ø | –ö–†–ò–¢–ò–ß–ù–ê |
| –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ä–æ–≥–æ raw_text | check_missing_points() | –í–´–°–û–ö–ê–Ø | –í–ê–ñ–ù–û |
| –¢—Ä–∏ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ | bot.py | –°—Ä–µ–¥–Ω—è—è | –í–ê–ñ–ù–û |
| –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π —Ñ–ª–∞–≥ | handle_confirmation_choice() | –ù–∏–∑–∫–∞—è | –£–õ–£–ß–®–ï–ù–ò–ï |

---

## ‚úÖ –ò–¢–û–ì–û–í–´–ô –°–ü–ò–°–û–ö –§–£–ù–ö–¶–ò–ô –° –ü–†–û–ë–õ–ï–ú–ê–ú–ò

1. **parser_functions.py, —Å—Ç—Ä–æ–∫–∏ 285-327**
   - ‚ùå –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ (–¥–≤–µ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ —Å—Ç—Ä–æ–∫–∏ "# ========== 4. –û–ë–†–ê–ë–û–¢–ö–ê –í–ó–†–û–°–õ–´–•")
   - –†–∏—Å–∫: –î–≤–æ–π–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —á–∏—Å–µ–ª

2. **parser_functions.py, —Å—Ç—Ä–æ–∫–∏ 410-425**
   - ‚ùå –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ old raw_text –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–µ—Ç–µ–π
   - –†–∏—Å–∫: –ù–µ—Å–æ—Å—Ç—ã–∫–æ–≤–∫–∞ –º–µ–∂–¥—É –∑–∞—è–≤–ª–µ–Ω–Ω—ã–º –∏ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–º

3. **bot.py, —Å—Ç—Ä–æ–∫–∞ 665-700 (save_partial_data)**
   - ‚ùå –£—Å–ª–æ–≤–∏–µ if new_data['children'] –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫
   - –†–∏—Å–∫: –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –¥–µ—Ç–µ–π –ø—Ä–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏

4. **bot.py, —Å—Ç—Ä–æ–∫–∏ 1844, 1904, 1925**
   - ‚ùå –¢—Ä–∏ —Ä–∞–∑–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å —Ä–∞–∑–Ω–æ–π –ª–æ–≥–∏–∫–æ–π
   - ‚ùå –ü–µ—Ä–≤–∞—è –∏ —Ç—Ä–µ—Ç—å—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç, –≤—Ç–æ—Ä–∞—è –º–æ–∂–µ—Ç –Ω–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å
   - –†–∏—Å–∫: –ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

5. **bot.py, —Å—Ç—Ä–æ–∫–∞ 2070**
   - ‚ùå –§–ª–∞–≥ waiting_for_correction –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
   - –†–∏—Å–∫: –ú—ë—Ä—Ç–≤—ã–π –∫–æ–¥, –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –æ—à–∏–±–æ—á–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤ –±—É–¥—É—â–µ–º

---

**–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ. –ö–æ–¥ —Å–æ–¥–µ—Ä–∂–∏—Ç 5 –≥—Ä—É–ø–ø –ø—Ä–æ–±–ª–µ–º —Ä–∞–∑–Ω–æ–π –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏.**
