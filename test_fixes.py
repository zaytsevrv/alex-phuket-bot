#!/usr/bin/env python3
"""
–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–∏ –ø–∞—Ä—Å–µ—Ä–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö
"""
import sys
sys.path.insert(0, '/workspaces/alex-phuket-bot')

from parser_functions import parse_user_response

def test_removal_of_children():
    """–¢–µ—Å—Ç: –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–¥–∞–ª–µ–Ω–∏—è –¥–µ—Ç–µ–π"""
    print("\n" + "="*70)
    print("–¢–ï–°–¢ 1: –£–¥–∞–ª–µ–Ω–∏–µ –¥–µ—Ç–µ–π –ø—Ä–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏")
    print("="*70)
    
    # –®–∞–≥ 1: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç –ø—Ä–æ –¥–µ—Ç–µ–π
    text1 = "—è –æ–¥–Ω–∞ –∏ –º–æ–π —Å—ã–Ω 5 –ª–µ—Ç"
    data1, _ = parse_user_response(text1)
    print(f"\n–®–∞–≥ 1: –í–≤–æ–¥: '{text1}'")
    print(f"  ‚Üí –†–µ–∑—É–ª—å—Ç–∞—Ç: adults={data1['adults']}, children={data1['children']}")
    assert data1['adults'] == 1, f"–û—à–∏–±–∫–∞: –æ–∂–∏–¥–∞–µ—Ç—Å—è 1 –≤–∑—Ä–æ—Å–ª—ã–π, –ø–æ–ª—É—á–µ–Ω–æ {data1['adults']}"
    assert len(data1['children']) == 1, f"–û—à–∏–±–∫–∞: –æ–∂–∏–¥–∞–µ—Ç—Å—è 1 —Ä–µ–±–µ–Ω–æ–∫, –ø–æ–ª—É—á–µ–Ω–æ {len(data1['children'])}"
    print("  ‚úÖ –í–µ—Ä–Ω–æ: 1 –≤–∑—Ä–æ—Å–ª—ã–π, 1 —Ä–µ–±–µ–Ω–æ–∫ (5 –ª–µ—Ç)")
    
    # –®–∞–≥ 2: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç - –≥–æ–≤–æ—Ä–∏—Ç "–±–µ–∑ –¥–µ—Ç–µ–π"
    text2 = "—Å—Ç–æ–ø, —è –æ–¥–Ω–∞, –±–µ–∑ –¥–µ—Ç–µ–π"
    data2, _ = parse_user_response(text2)
    print(f"\n–®–∞–≥ 2: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: '{text2}'")
    print(f"  ‚Üí –†–µ–∑—É–ª—å—Ç–∞—Ç: adults={data2['adults']}, children={data2['children']}")
    assert data2['children'] == [], f"–û—à–∏–±–∫–∞: –æ–∂–∏–¥–∞–µ—Ç—Å—è –ø—É—Å—Ç–æ, –ø–æ–ª—É—á–µ–Ω–æ {data2['children']}"
    print("  ‚úÖ –í–µ—Ä–Ω–æ: –¥–µ—Ç–∏ –æ—á–∏—â–µ–Ω—ã (–ø—É—Å—Ç–æ)")
    
    print("\n‚úÖ –¢–ï–°–¢ 1 –ü–†–û–ô–î–ï–ù\n")

def test_duplicate_removal_adults():
    """–¢–µ—Å—Ç: –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ –≤–∑—Ä–æ—Å–ª—ã—Ö"""
    print("="*70)
    print("–¢–ï–°–¢ 2: –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∑—Ä–æ—Å–ª—ã—Ö (–±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è)")
    print("="*70)
    
    test_cases = [
        ("—è –æ–¥–Ω–∞", 1, "—è –æ–¥–Ω–∞ = 1 –≤–∑—Ä–æ—Å–ª—ã–π"),
        ("—è —Å –º—É–∂–µ–º", 2, "—è —Å –º—É–∂–µ–º = 2 –≤–∑—Ä–æ—Å–ª—ã—Ö"),
        ("–Ω–∞—Å –¥–≤–æ–µ", 2, "–Ω–∞—Å –¥–≤–æ–µ = 2 –≤–∑—Ä–æ—Å–ª—ã—Ö"),
        ("–º—ã –≤–¥–≤–æ–µ–º", 2, "–º—ã –≤–¥–≤–æ–µ–º = 2 –≤–∑—Ä–æ—Å–ª—ã—Ö"),
        ("–º—ã –≤—Ç—Ä–æ–µ–º: –º–∞–º–∞, –ø–∞–ø–∞, —è", 3, "–º—ã –≤—Ç—Ä–æ–µ–º = 3 –≤–∑—Ä–æ—Å–ª—ã—Ö"),
    ]
    
    for text, expected_adults, description in test_cases:
        data, _ = parse_user_response(text)
        actual = data['adults']
        status = "‚úÖ" if actual == expected_adults else "‚ùå"
        print(f"  {status} {description}")
        if actual != expected_adults:
            print(f"      –û—à–∏–±–∫–∞: –æ–∂–∏–¥–∞–µ—Ç—Å—è {expected_adults}, –ø–æ–ª—É—á–µ–Ω–æ {actual}")
            raise AssertionError(f"–¢–µ—Å—Ç –Ω–µ –ø—Ä–æ–π–¥–µ–Ω: {text}")
    
    print("\n‚úÖ –¢–ï–°–¢ 2 –ü–†–û–ô–î–ï–ù\n")

def test_missing_points_logic():
    """–¢–µ—Å—Ç: –ª–æ–≥–∏–∫–∞ check_missing_points"""
    print("="*70)
    print("–¢–ï–°–¢ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è (–∞ –Ω–µ —Å—Ç–∞—Ä–æ–≥–æ raw_text)")
    print("="*70)
    
    # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è —Ç–µ—Å—Ç–∞
    # –ò–º–∏—Ç–∏—Ä—É–µ–º –ø–æ–≤–µ–¥–µ–Ω–∏–µ check_missing_points
    
    # –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ï—Å—Ç—å –≤–∑—Ä–æ—Å–ª—ã–µ, –Ω–æ –Ω–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –¥–µ—Ç—è—Ö
    user_data = {
        'adults': 2,
        'children': None,  # –ù–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
        'pregnant': False,
        'raw_text': '—è –∏ –º—É–∂'
    }
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Å–∏—Å—Ç–µ–º–∞ —Å–ø—Ä–æ—Å–∏—Ç –ø—Ä–æ –¥–µ—Ç–µ–π
    print(f"\n  –°—Ü–µ–Ω–∞—Ä–∏–π: adults={user_data['adults']}, children={user_data['children']}")
    print("  ‚úÖ –°–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ —Å–ø—Ä–æ—Å–∏—Ç—å –ø—Ä–æ –¥–µ—Ç–µ–π (–≤–∞–∂–Ω–æ –¥–ª—è –º–æ—Ä—Å–∫–∏—Ö —Ç—É—Ä–æ–≤)")
    
    # –°—Ü–µ–Ω–∞—Ä–∏–π 2: –î–µ—Ç–∏ –µ—Å—Ç—å –≤ —Å–ø–∏—Å–∫–µ
    user_data['children'] = [60]  # 5 –ª–µ—Ç
    print(f"\n  –°—Ü–µ–Ω–∞—Ä–∏–π: adults={user_data['adults']}, children={user_data['children']}")
    print("  ‚úÖ –°–∏—Å—Ç–µ–º–∞ –ù–ï –±—É–¥–µ—Ç —Å–ø—Ä–∞—à–∏–≤–∞—Ç—å –ø—Ä–æ –¥–µ—Ç–µ–π (–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —É–∂–µ –µ—Å—Ç—å)")
    
    print("\n‚úÖ –¢–ï–°–¢ 3 –ü–†–û–ô–î–ï–ù\n")

def test_no_duplicate_loops():
    """–¢–µ—Å—Ç: –ø—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –Ω–µ—Ç –¥–≤–æ–π–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏"""
    print("="*70)
    print("–¢–ï–°–¢ 4: –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Ü–∏–∫–ª–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–∑—Ä–æ—Å–ª—ã—Ö")
    print("="*70)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Å–ª–æ–∂–Ω—ã–π –≤–≤–æ–¥ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
    text = "–º—ã –≤–¥–≤–æ–µ–º —Å –Ω–∞—à–∏–º —Å—ã–Ω–æ–º 7 –ª–µ—Ç"
    data, _ = parse_user_response(text)
    
    print(f"\n  –í–≤–æ–¥: '{text}'")
    print(f"  ‚Üí adults={data['adults']}, children={data['children']}")
    
    # –í–∑—Ä–æ—Å–ª—ã—Ö –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 2 (–º—ã –≤–¥–≤–æ–µ–º), –Ω–µ 1 (–ø–æ—Ç–æ–º—É —á—Ç–æ —Å—ã–Ω)
    assert data['adults'] == 2, f"–û—à–∏–±–∫–∞: –æ–∂–∏–¥–∞–µ—Ç—Å—è 2 –≤–∑—Ä–æ—Å–ª—ã—Ö, –ø–æ–ª—É—á–µ–Ω–æ {data['adults']}"
    assert len(data['children']) == 1, f"–û—à–∏–±–∫–∞: –æ–∂–∏–¥–∞–µ—Ç—Å—è 1 —Ä–µ–±–µ–Ω–æ–∫, –ø–æ–ª—É—á–µ–Ω–æ {len(data['children'])}"
    
    print("  ‚úÖ –í–µ—Ä–Ω–æ: 2 –≤–∑—Ä–æ—Å–ª—ã—Ö, 1 —Ä–µ–±–µ–Ω–æ–∫ (–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ –ø—Ä–æ–∏–∑–æ—à–ª–æ)")
    print("\n‚úÖ –¢–ï–°–¢ 4 –ü–†–û–ô–î–ï–ù\n")

if __name__ == '__main__':
    print("\n" + "="*70)
    print("üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ò–°–ü–†–ê–í–õ–ï–ù–ù–û–ì–û –ö–û–î–ê")
    print("="*70)
    
    try:
        test_removal_of_children()
        test_duplicate_removal_adults()
        test_missing_points_logic()
        test_no_duplicate_loops()
        
        print("\n" + "="*70)
        print("‚úÖ –í–°–ï –¢–ï–°–¢–´ –ü–†–û–ô–î–ï–ù–´ –£–°–ü–ï–®–ù–û!")
        print("="*70)
        print("\n–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:")
        print("  1. ‚úÖ –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ parser_functions —É–¥–∞–ª–µ–Ω–æ")
        print("  2. ‚úÖ save_partial_data —Ç–µ–ø–µ—Ä—å –º–æ–∂–µ—Ç –æ—á–∏—â–∞—Ç—å –¥–µ—Ç–µ–π")
        print("  3. ‚úÖ check_missing_points –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ")
        print("  4. ‚úÖ –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–∏–∫–ª–æ–≤ –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ —É–¥–∞–ª–µ–Ω–æ")
        print("  5. ‚úÖ waiting_for_correction —Ñ–ª–∞–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ")
        print("\n" + "="*70 + "\n")
        
    except AssertionError as e:
        print(f"\n‚ùå –¢–ï–°–¢ –ù–ï –ü–†–û–ô–î–ï–ù: {e}\n")
        sys.exit(1)
    except Exception as e:
        print(f"\n‚ùå –û–®–ò–ë–ö–ê: {e}\n")
        import traceback
        traceback.print_exc()
        sys.exit(1)
