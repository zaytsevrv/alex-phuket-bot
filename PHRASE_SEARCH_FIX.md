# ✅ ИСПРАВЛЕНИЕ: Гибридный поиск для фраз со стоп-словами

## Проблема
Когда пользователь написал "хочу увидеть слонов", бот вместо поиска туров про слонов вызывал DeepSeek (или находил неправильные туры про "увидеть острова").

## Корневая причина
В функции `search_tours_by_keywords_hybrid()` при поиске по отдельным словам из фразы проверялись слова в порядке их появления:
1. "хочу" → не найдено
2. "увидеть" → найдено 7 туров про острова (содержат слово "увидеть")
3. "слонов" → никогда не проверялось

Поиск завершался на втором слове "увидеть" и возвращал неправильные результаты.

## Решение
Добавили фильтр стоп-слов и улучшенный порядок проверки:

1. **Определили стоп-слова** - слова которые не помогают в поиске туров:
   - "хочу", "давайте", "укажите", "посоветуйте"
   - "что", "как", "где", "когда"
   - "увидеть", "видеть", "показать", "узнать"
   - И другие подобные

2. **Отсеиваем стоп-слова** - из фразы "хочу увидеть слонов" остаются только:
   - "слонов" (остальные отсеиваются как стоп-слова)

3. **Сортируем по специфичности** - длинные слова проверяем первыми (они обычно более специфичные)

## Результаты тестирования

✅ "хочу увидеть слонов" → находит 2 тура про слонов
✅ "рафтинг" → находит 1 тур с рафтингом
✅ "слоны" → находит 7 туров со слонами

## Код изменений

Файл: [bot.py](bot.py#L415)

```python
def search_tours_by_keywords_hybrid(query):
    # Шаг 1: Точный поиск по всей фразе
    results = search_tours_by_keywords(query)
    if results:
        return results, query
    
    # Шаг 2: Поиск в отдельных словах (с отсеиванием стоп-слов)
    words = query.lower().split()
    
    stop_words = {'хочу', 'давайте', 'укажите', 'ответьте', 'посоветуйте',
                  'что', 'как', 'где', 'когда', 'приложить', 'пожалуйста',
                  'буду', 'нужна', 'нужны', 'можно', 'есть', 'все', 'если',
                  'про', 'рассказать', 'ищу', 'посмотреть', 'увидеть', 'видеть',
                  'показать', 'узнать', 'расскажи'}
    
    # Отсеиваем стоп-слова и сортируем по длине (специфичность)
    content_words = [w for w in words if len(w) > 3 and w not in stop_words]
    content_words.sort(key=len, reverse=True)  # Длинные слова первыми
    
    for word in content_words:
        results = search_tours_by_keywords(word)
        if results:
            return results, word
    
    # Шаги 3-4: Размытый поиск (difflib) если ничего не найдено...
```

## Файлы затронуты
- [bot.py](bot.py#L415-L450) - обновлена функция `search_tours_by_keywords_hybrid()`
- [test_phrase_search.py](test_phrase_search.py) - новый файл с тестами фразового поиска
